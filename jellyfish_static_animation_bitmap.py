#!/usr/bin/env python3
"""
Jellyfish Bitmap Static Image for LED Board
Displays a static jellyfish bitmap image for 5 seconds
"""

import time
from led_controller_exact import LEDControllerExact
import config

class JellyfishStaticAnimationBitmap:
    def __init__(self):
        """Initialize the jellyfish bitmap static animation."""
        self.led = LEDControllerExact()
        self.width = config.TOTAL_WIDTH
        self.height = config.TOTAL_HEIGHT
        
        # Jellyfish bitmap data (32x48 pixels)
        bitmap_hex = [
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x1f, 0xff,
            0xff, 0xf0, 0x03, 0xff, 0xff, 0xe7, 0xf1, 0xff, 0xff, 0xcf, 0x8c, 0xff, 0xff, 0x9f, 0xc6, 0x7f,
            0xff, 0xdf, 0xf3, 0x3f, 0xff, 0xcf, 0xf9, 0xbf, 0xff, 0xc1, 0xfc, 0x9f, 0xff, 0x1c, 0xfe, 0xdf,
            0xff, 0x7c, 0xfe, 0xdf, 0xff, 0x70, 0xff, 0xdf, 0xfe, 0x66, 0x3f, 0xdf, 0xf8, 0xef, 0x0f, 0xdf,
            0xf3, 0xee, 0x0f, 0x9f, 0xff, 0xcc, 0xe7, 0xbf, 0xfe, 0x1d, 0xe7, 0x3f, 0xfc, 0xf9, 0xc0, 0x7f,
            0xfd, 0xfb, 0x99, 0xff, 0xfd, 0xc3, 0x3f, 0xff, 0xf9, 0x9f, 0x3f, 0xff, 0xf3, 0xbe, 0x7f, 0xff,
            0xff, 0x38, 0xff, 0xff, 0xff, 0x73, 0xff, 0xff, 0xff, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
        ]
        
        self.jellyfish_pixels = []
        for row in range(48):
            row_data = []
            byte_start = row * 4
            for col in range(32):
                byte_index = byte_start + (col // 8)
                bit_index = 7 - (col % 8)
                byte_value = bitmap_hex[byte_index]
                pixel = (byte_value >> bit_index) & 1
                row_data.append(1 - pixel)
            self.jellyfish_pixels.append(row_data)
        
        self.jellyfish_color = (255, 255, 255)
        
    def safe_set_pixel(self, x, y, color):
        if 0 <= x < self.width and 0 <= y < self.height:
            self.led.set_pixel(x, y, color)
    
    def draw_jellyfish(self):
        self.led.clear()
        for y in range(min(self.height, 48)):
            for x in range(min(self.width, 32)):
                if self.jellyfish_pixels[y][x] == 1:
                    self.safe_set_pixel(x, y, self.jellyfish_color)
        self.led.show()
    
    def run_animation(self, should_stop=None):
        duration = 5
        start_time = time.time()
        print("ðŸª¼ Starting jellyfish bitmap static image...")
        self.draw_jellyfish()
        while time.time() - start_time < duration:
            if should_stop and should_stop():
                print("ðŸª¼ Jellyfish bitmap image stopped by user")
                break
            time.sleep(0.1)
        print("ðŸª¼ Jellyfish bitmap image completed!")
        self.led.clear()
        self.led.show()
    
    def cleanup(self):
        self.led.cleanup()

